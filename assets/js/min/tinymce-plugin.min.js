!function(){tinymce.create("tinymce.plugins.anspress",{init:function(a,b){a.on("PreProcess",function(b){$content=jQuery(b.node),$ta_name=jQuery('input[name="'+jQuery(a.getElement()).attr("id")+'-images[]"]'),$ta_name.each(function(){$filename=jQuery(this).attr("data-filename"),0===$content.find('[data-apimagename="'+$filename+'"]').length&&jQuery(this).remove()})}),a.on("SaveContent",function(a){a.content=a.content.replace(/<img([^>]+data-apimagename.*?[\w\W]+?)\/>/g,function(a,b){return regex=/data-apimagename\=\"(.*)\"/g,apimagename=regex.exec(a),regex=/alt\=\"([^"]*)\"/g,alt=regex.exec(a),'{{apimage "'+apimagename[1]+'" "'+alt[1]+'"}}'})}),a.addButton("apmedia",{title:a.getLang("anspress.i18n_insert_image"),icon:"image",onclick:function(){var b=a.windowManager.open({title:a.getLang("anspress.i18n_insert_media"),id:"ap-image-window",resizable:!0,scrollbars:!0,width:500,height:300,buttons:[{text:"Insert",subtype:"primary",onclick:function(){var c=b.find("#image-preview")[0].$el.context,d=b.find("#file-title")[0].$el.context;a.insertContent('<img src="'+jQuery(c).find("img").attr("src")+'" alt="'+jQuery(d).val()+'" data-apimagename="'+jQuery(c).find("img").attr("data-apimagename")+'" />'),b.close()}},{text:a.getLang("anspress.i18n_close"),onclick:function(){b.close()}}],body:[{type:"button",name:"file-browser",label:a.getLang("anspress.i18n_select_file"),text:a.getLang("anspress.i18n_browse_from_computer"),id:"ap-image-window-btn",onclick:function(c){$ta_name=jQuery(a.getElement()).attr("id")+"-images[]";var d=jQuery('<input name="'+$ta_name+'" type="file" accept="image/*" />').hide();d.insertAfter(a.getElement()),d.on("change",function(a){var c=this;if(this.files&&this.files[0]){var e=new FileReader;e.onload=function(a){var e=b.find("#image-preview")[0].$el.context;jQuery(e).html('<div class="ap-image-prev" style="position: relative"><img style="height: 150px;width: auto;max-width: 100%" src="'+a.target.result+'" data-apimagename="'+c.files[0].name+'" /></div>'),d.attr("data-filename",c.files[0].name)},e.readAsDataURL(this.files[0])}}),d.click()}},{type:"textbox",name:"file-title",label:a.getLang("anspress.i18n_image_title"),minWidth:300},{type:"container",name:"image-preview",label:a.getLang("anspress.i18n_media_preview")}]})}})},createControl:function(a,b){return null}}),tinymce.PluginManager.add("anspress",tinymce.plugins.anspress)}();
//# sourceMappingURL=tinymce-plugin.min.js.map