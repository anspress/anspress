window.AnsPress=_.extend({models:{},views:{},collections:{},loadTemplate:function(a){0==jQuery("#apTemplate").length&&jQuery('<script id="apTemplate" type="text/html"></script>').appendTo("body"),jQuery.get(apTemplateUrl+"/"+a+".html",function(a){var b=jQuery("#apTemplate");b.text(a+b.text()),AnsPress.trigger("templateLoaded")})},getTemplate:function(a){return function(){if(0==jQuery("#apTemplate").length)return"";var b=new RegExp("#START BLOCK "+a+" #([\\S\\s]*?)#END BLOCK "+a+" #","g"),c=b.exec(jQuery("#apTemplate").text());return null==c?"":c[1]?c[1]:void 0}},isJSONString:function(a){try{return jQuery.parseJSON(a)}catch(a){return!1}},ajaxResponse:function(a){if(a=jQuery(a),"undefined"==typeof a.filter("#ap-response"))return console.log("Not a valid AnsPress ajax response."),{};var b=this.isJSONString(a.filter("#ap-response").html());return b&&"undefined"!==b&&_.isObject(b)?b:{}},ajax:function(a){var b=this;a=_.defaults(a,{url:ajaxurl,method:"POST"}),_.isObject(a.data)&&(a.data=jQuery.param(a.data)),a.data="action=ap_ajax&"+a.data;var c=a.success;return delete a.success,a.success=function(d){var e=a.context||null,f=b.ajaxResponse(d);f.snackbar&&AnsPress.trigger("snackbar",f),"function"==typeof c&&(d=jQuery.isEmptyObject(f)?d:f,c(d,e))},jQuery.ajax(a)},uniqueId:function(){return jQuery(".ap-uid").length},showLoading:function(a){AnsPress.hideLoading(a);var b=jQuery(a).data("loadclass")||"",c=jQuery(a).is('input[type="text"]'),d=this.uniqueId(),e=jQuery('<div class="ap-loading-icon ap-uid '+b+(c?" is-text":"")+'" id="apuid-'+d+'"><i></i></div>');jQuery("body").append(e);var f=jQuery(a).offset(),g=jQuery(a).outerHeight(),h=c?40:jQuery(a).outerWidth();return e.css({top:f.top,left:c?f.left+jQuery(a).outerWidth()-40:f.left,height:g,width:h}),jQuery(a).data("loading","#apuid-"+d),"#apuid-"+d},hideLoading:function(a){"all"==a?jQuery(".ap-loading-icon").hide():jQuery(jQuery(a).data("loading")).hide()},getUrlParam:function(a){var b=jQuery.apParseParams(window.location.href);return"undefined"!=typeof a?"undefined"!=typeof b[a]?b[a]:null:b}},Backbone.Events),_.templateSettings={evaluate:/<#([\s\S]+?)#>/g,interpolate:/\{\{\{([\s\S]+?)\}\}\}/g,escape:/\{\{([^\}]+?)\}\}(?!\})/g},function(a){a.fn.autogrow=function(b){function c(c){var d,e=a(this),f=e.innerHeight(),g=this.scrollHeight,h=e.data("autogrow-start-height")||0;if(f<g)this.scrollTop=0,b.animate?e.stop().animate({height:g},b.speed):e.innerHeight(g);else if(!c||8==c.which||46==c.which||c.ctrlKey&&88==c.which)if(f>h){d=e.clone().addClass(b.cloneClass).css({position:"absolute",zIndex:-10,height:""}).val(e.val()),e.after(d);do g=d[0].scrollHeight-1,d.innerHeight(g);while(g===d[0].scrollHeight);g++,d.remove(),e.focus(),g<h&&(g=h),f>g&&b.animate?e.stop().animate({height:g},b.speed):e.innerHeight(g)}else e.innerHeight(h)}var d=a(this).css({overflow:"hidden",resize:"none"}),e=d.selector,f={context:a(document),animate:!0,speed:50,fixMinHeight:!0,cloneClass:"autogrowclone",onInitialize:!1};return b=a.isPlainObject(b)?b:{context:b?b:a(document)},b=a.extend({},f,b),d.each(function(d,e){var f,g;e=a(e),e.is(":visible")||parseInt(e.css("height"),10)>0?f=parseInt(e.css("height"),10)||e.innerHeight():(g=e.clone().addClass(b.cloneClass).val(e.val()).css({position:"absolute",visibility:"hidden",display:"block"}),a("body").append(g),f=g.innerHeight(),g.remove()),b.fixMinHeight&&e.data("autogrow-start-height",f),e.css("height",f),b.onInitialize&&e.length&&c.call(e[0])}),b.context.on("keyup paste focus",e,c),d},jQuery.fn.apScrollTo=function(b,c,d){c=c||!1;var e=a(this).scrollTop()-a(this).offset().top,f=c?a(this).offset().top+a(this).height():a(this).offset().top;return a("html, body").stop(),a("html, body").animate({scrollTop:f},void 0==d?1e3:d),void 0!=b&&a(this).animate({scrollTop:e+a(b).offset().top},void 0==d?1e3:d),this},AnsPress.views.Snackbar=Backbone.View.extend({id:"ap-snackbar",template:'<div class="ap-snackbar<# if(success){ #> success<# } #>">{{message}}</div>',hover:!1,initialize:function(){AnsPress.on("snackbar",this.show,this)},events:{mouseover:"toggleHover",mouseout:"toggleHover"},show:function(a){var b=this;this.data=a.snackbar,this.data.success=a.success,this.$el.removeClass("snackbar-show"),this.render(),setTimeout(function(){b.$el.addClass("snackbar-show")},0),this.hide()},toggleHover:function(){clearTimeout(this.hoveTimeOut),this.hover=!this.hover,this.hover||this.hide()},hide:function(){var a=this;a.hover||(this.hoveTimeOut=setTimeout(function(){a.$el.removeClass("snackbar-show")},2e3))},render:function(){if(this.data){var a=_.template(this.template);this.$el.html(a(this.data))}return this}}),a.fn.AnsPressTags=function(){function b(a){return a=a.replace(/^\s+|\s+$/g,""),a=a.toLowerCase(),a=a.replace(/\s+/g,"-").replace(/-+/g,"-")}function c(a){var b=document.createElement("div");return b.appendChild(document.createTextNode(a)),b.innerHTML}function d(b,c,d,e,f){if(!(e.parent().find('.ap-tag-item[data-val="'+b+'"]').length>0)){if(e.parent().find(".ap-tag-item").length>=f.max_tags)return AnsPress.trigger("snackbar",{success:!1,snackbar:{message:f.label_max_tag_added}}),!1;$newFieldName=d+"["+b+"]";var g=a('<span class="ap-tag-item" data-val="'+b+'">'+c+'<input type="hidden" name="'+$newFieldName+'" value="'+c+'" /></span>');h&&h.find('li[data-val="'+b+'"]').remove(),a(g).insertBefore(e),AnsPress.trigger("renderTagItem",g,b,c,d,e)}}function e(b,c){if(h){$allListElements=h.find("li");var d=$allListElements.not(".disable").filter(function(c,d){var e=a(d).text().toUpperCase(),f=b.val().toUpperCase();return~e.indexOf(f)});$allListElements.each(function(){var c=new RegExp("("+b.val()+")","ig");a(this).html(a(this).text().replace(c,"<b>$1</b>"))}),$notMatched=a.grep($allListElements,function(b){return a.inArray(b,d)===-1}),a.each($notMatched,function(b){a(this).remove()}),0===h.find("li:not(.disable)").length&&h.append('<li class="disable">'+c.label_no_matching+" "+(c.add_tag?c.label_add_new+'<input type="text" placeholder="Type and hit enter" class="new-tag-entry" />':"")+"</li>")}}function f(b,c,d,f){var g="",h="object"==typeof b;a.isEmptyObject(b)?f.add_tag?(d.allowNewTag=!0,g+='<li class="disable">'+f.label_no_tags+" "+f.label_add_new+'<input type="text" placeholder="Type and hit enter" class="new-tag-entry" /></li>'):g+='<li class="disable">'+f.label_no_tags+"</li>":a.each(b,function(a,b){var c=h?a:b;0==d.closest(".ap-tag-wrap").find("span.ap-tag-item[data-val='"+c+"']").length&&(g+='<li data-val="'+c+'">'+b+"</li>")});var i=a('<ul class="ap-tags-suggestion">'+g+"</ul>").css("left",d.position().left);return e(d,f),i}function g(){h&&(h.remove(),h=null,clearTimeout(i))}var h,i;return a(document).mouseup(function(b){h&&(h.dontHide=!0);var c=a(".ap-tags-suggestion");c.is(b.target)||0!==c.has(b.target).length||c.remove()}),this.each(function(){var j=a(this),k=j.data("options"),l=j.data("name"),m=a(this).find("#"+j.data("id")),n=j.find("script").length>0?JSON.parse(j.find("script").html()):{};j.on("click",".ap-tag-item",function(){a(this).remove()}),j.on("click",function(a){a.target===this&&m.click().focus()}),j.on("keydown",".new-tag-entry",function(e){if(13==e.keyCode){e.preventDefault();var f=a(this).val().trim();d(b(f),c(f),l,m,k),a(this).val(""),m.val("")}}),j.on("click",".ap-tags-suggestion li:not(.disable)",function(b){b.target===this&&(d(a(this).attr("data-val"),a(this).text(),l,m,k),a(this).remove(),m.val(""))}),m.on("keydown",function(b){if(13==b.keyCode&&b.preventDefault(),8==b.keyCode&&(""===m.val()&&m.prev().is(".ap-tag-item")&&m.prev().remove(),g()),40!=b.keyCode||h||(h=a(f(n,l,m,k)),j.append(h)),38==b.keyCode||40==b.keyCode){var c=(h.find(".ap-tag-item"),h.find("li.focus").index());h.find("li").length-1;h.find("li").removeClass("focus"),c==-1?c=0:40==b.keyCode?c++:c--;var d=h.find("li").eq(c);if(d.length>0){d.addClass("focus");var e=d.position();a(h).animate({scrollTop:e.top},0)}}}),m.on("keyup",function(b){h||(h=a(f(n,l,m,k)),j.append(h));var c=h.find("li.focus");if(c.length>0&&(13==b.keyCode||188==b.keyCode)){a(this).val().replace(/,\s*$/,"");d(c.attr("data-val"),c.text(),l,m,k),a(this).val(""),g()}38!=b.keyCode&&40!=b.keyCode&&e(m,k)}),m.on("click",function(b){g(),h=a(f(n,l,m,k)),j.append(h)}),m.on("blur",function(a){h&&h.find("li input").is(".new-tag-entry")||(clearTimeout(i),i=setTimeout(function(){g()},200))})})};var b=/([^&=]+)=?([^&]*)/g,c=function(a){return decodeURIComponent(a.replace(/\+/g," "))};a.apParseParams=function(d){function e(b,c,d){if(c+="",c.indexOf(".")!==-1){var f=c.split("."),g=c.split(/\.(.+)?/)[1];b[f[0]]||(b[f[0]]={}),""!==g?e(b[f[0]],g,d):console.warn('parseParams :: empty property in key "'+c+'"')}else if(c.indexOf("[")!==-1){var f=c.split("[");c=f[0];var f=f[1].split("]"),h=f[0];""==h?(b||(b={}),b[c]&&a.isArray(b[c])||(b[c]=[]),b[c].push(d)):(b||(b={}),b[c]&&a.isArray(b[c])||(b[c]=[]),b[c][parseInt(h)]=d)}else b||(b={}),b[c]=d}d+="",""===d&&(d=window.location+"");var f,g={};if(d){if(d.indexOf("#")!==-1&&(d=d.substr(0,d.indexOf("#"))),d.indexOf("?")===-1)return{};if(d=d.substr(d.indexOf("?")+1,d.length),""==d)return{};for(;f=b.exec(d);){var h=c(f[1]),i=c(f[2]);e(g,h,i)}}return g};var d=new AnsPress.views.Snackbar;a("body").append(d.render().$el)}(jQuery),jQuery(document).ready(function(a){a(document).click(function(b){b.stopPropagation(),a(b.target).is(".ap-dropdown-toggle")||a(b.target).closest(".open").is(".open")||a(b.target).closest("form").is("form")||a(".ap-dropdown").removeClass("open")}),a("body").on("click",".ap-dropdown-toggle, .ap-dropdown-menu > a",function(b){b.preventDefault(),a(".ap-dropdown").not(a(this).closest(".ap-dropdown")).removeClass("open"),a(this).closest(".ap-dropdown").toggleClass("open")}),a("[ap-subscribe]").click(function(b){b.preventDefault();var c=a(this),d=JSON.parse(c.attr("ap-query"));d.ap_ajax_action="subscribe",AnsPress.ajax({data:d,success:function(a){a.count&&c.next().text(a.count),a.label&&c.text(a.label)}})}),a("body").on("click",".ap-droptogg",function(b){b.preventDefault(),a(this).closest(".ap-dropdown").removeClass("open"),a(this).closest("#noti-dp").hide()}),a("body").on("click","[ap-ajax-btn]",function(b){var c=this;if(b.preventDefault(),!a(this).is(".loaded")){var c=a(this),d=JSON.parse(c.attr("ap-query"));AnsPress.showLoading(c),AnsPress.ajax({data:d,success:function(d){a(c).addClass("loaded"),AnsPress.hideLoading(b.target),"undefined"!=typeof d.btn&&d.btn.hide&&c.hide(),"undefined"!=typeof d.cb&&AnsPress.trigger(d.cb,d)}})}}),a('[data-role="ap-tags"]').AnsPressTags(),a('[data-role="ap-repeatable"]').each(function(){a(this).find(".ap-repeatable-add").on("click",function(b){b.preventDefault();var c=a(this),d=JSON.parse(c.attr("ap-query"));AnsPress.showLoading(c),$count=a('[name="'+d.id+'-groups"]'),d.current_groups=$count.val(),$count.val(parseInt(d.current_groups)+1),$nonce=a('[name="'+d.id+'-nonce"]'),d.current_nonce=$nonce.val(),AnsPress.ajax({data:d,success:function(d){AnsPress.hideLoading(b.target),a(d.html).insertBefore(c),$nonce.val(d.nonce)}})}),a(this).on("click",".ap-repeatable-delete",function(b){b.preventDefault(),a(this).closest(".ap-form-group").remove()})}),a("body").on("click",".ap-form-group",function(){a(this).removeClass("ap-have-errors")}),a("[apform]").each(function(){var b=a(this);a(b).ajaxForm({url:ajaxurl,beforeSerialize:function(){void 0!==typeof tinymce&&tinymce.triggerSave(),a(".ap-form-errors, .ap-field-errors").remove(),a(".ap-have-errors").removeClass("ap-have-errors")},success:function(c){c=AnsPress.ajaxResponse(c),c.snackbar&&AnsPress.trigger("snackbar",c),"undefined"!=typeof c.form_errors&&($formError=a('<div class="ap-form-errors"></div>').prependTo(b),a.each(c.form_errors,function(a,b){$formError.append('<span class="ap-form-error ecode-'+a+'">'+b+"</div>")}),a.each(c.fields_errors,function(b,c){a(".ap-field-"+b).addClass("ap-have-errors"),a(".ap-field-"+b).find(".ap-field-errorsc").html('<div class="ap-field-errors"></div>'),a.each(c.error,function(c,d){a(".ap-field-"+b).find(".ap-field-errors").append('<span class="ap-field-error ecode-'+c+'">'+d+"</span>")})}),b.apScrollTo()),"undefined"!=typeof c.redirect&&(window.location=c.redirect)}})})}),window.AnsPress.Helper={toggleNextClass:function(a){jQuery(a).closest(".ap-field-type-group").find(".ap-fieldgroup-c").toggleClass("show")}},function(a){AnsPress.loadTemplate("question"),AnsPress.models.Action=Backbone.Model.extend({defaults:{cb:"",post_id:"",title:"",label:"",query:"",active:!1,header:!1,href:"#",count:"",prefix:"",checkbox:"",multiple:!1}}),AnsPress.collections.Actions=Backbone.Collection.extend({model:AnsPress.models.Action}),AnsPress.views.Action=Backbone.View.extend({id:function(){return this.postID},className:function(){var a="";return this.model.get("header")&&(a+=" ap-dropdown-header"),this.model.get("active")&&(a+=" active"),a},tagName:"li",template:AnsPress.getTemplate("action"),initialize:function(a){this.model=a.model,this.postID=a.postID,this.model.on("change",this.render,this),this.listenTo(this.model,"remove",this.removed)},events:{"click a":"triggerAction"},render:function(){var a=_.template(this.template());return this.$el.html(a(this.model.toJSON())),this.$el.attr("class",this.className()),this},triggerAction:function(a){var b=this.model.get("query");if(!_.isEmpty(b)){a.preventDefault();var c=this;AnsPress.showLoading(a.target);var d=this.model.get("cb");b.ap_ajax_action="action_"+d,AnsPress.ajax({data:b,success:function(b){AnsPress.hideLoading(a.target),b.redirect&&(window.location=b.redirect),!b.success||"status"!=d&&"toggle_delete_post"!=d||AnsPress.trigger("changedPostStatus",{postID:c.postID,data:b,action:c.model}),b.action&&c.model.set(b.action),b.postMessage&&c.renderPostMessage(b.postMessage),b.deletePost&&AnsPress.trigger("deletePost",b.deletePost),b.answersCount&&AnsPress.trigger("answerCountUpdated",b.answersCount)}})}},renderPostMessage:function(b){_.isEmpty(b)?a("#post-"+this.postID).find("postMessage").html(""):a("#post-"+this.postID).find("postMessage").html(b)},removed:function(){this.remove()}}),AnsPress.views.Actions=Backbone.View.extend({id:function(){return this.postID},searchTemplate:'<div class="ap-filter-search"><input type="text" search-filter placeholder="'+aplang.search+'" /></div>',tagName:"ul",className:"ap-actions",events:{"keyup [search-filter]":"searchInput"},initialize:function(a){this.model=a.model,this.postID=a.postID,this.multiple=a.multiple,this.action=a.action,this.nonce=a.nonce,AnsPress.on("changedPostStatus",this.postStatusChanged,this),this.listenTo(this.model,"add",this.added)},renderItem:function(a){var b=new AnsPress.views.Action({model:a,postID:this.postID});this.$el.append(b.render().$el)},render:function(){var a=this;return this.multiple&&this.$el.append(this.searchTemplate),this.model.each(function(b){a.renderItem(b)}),this},postStatusChanged:function(b){if(b.postID===this.postID){a("#post-"+this.postID).removeClass(function(){return this.className.split(" ").filter(function(a){return a.match(/status-/)}).join(" ")}),a("#post-"+this.postID).addClass("status-"+b.data.newStatus);var c=this.model.where({cb:"status",active:!0});c.forEach(function(a){a.set({active:!1})})}},searchInput:function(b){var c=this;clearTimeout(this.searchTO),this.searchTO=setTimeout(function(){c.search(a(b.target).val(),b.target)},600)},search:function(a,b){var c=this,d={nonce:this.nonce,ap_ajax_action:this.action,search:a,filter:this.filter,post_id:this.postID};AnsPress.showLoading(b),AnsPress.ajax({data:d,success:function(a){if(console.log(a),AnsPress.hideLoading(b),a.success){for(c.nonce=a.nonce;m=c.model.first();)c.model.remove(m);c.model.add(a.actions)}}})},added:function(a){this.renderItem(a)}}),AnsPress.models.Post=Backbone.Model.extend({idAttribute:"ID",defaults:{actionsLoaded:!1,hideSelect:""}}),AnsPress.models.Comment=Backbone.Model.extend({idAttribute:"ID",defaults:{ID:"",userID:"",avatar:"",content:"",actions:""}}),AnsPress.collections.Comments=Backbone.Collection.extend({model:AnsPress.models.Comment}),AnsPress.views.Comment=Backbone.View.extend({tagName:"ap-comment",id:function(){return"comment-"+this.model.id},className:function(){var a=this.model.get("class");return"0"===this.model.get("approved")&&(a+=" unapproved"),a},template:AnsPress.getTemplate("comment"),initialize:function(a){this.model=a.model,this.postID=a.postID,this.model.on("change",this.render,this)},events:{'click [ap="comment_action"]':"actions",'click [ap="edit_comment"]':"editCommentForm"},render:function(){var a=_.template(this.template());return this.$el.html(a(this.model.toJSON())),this.$el.attr("class",this.className()),this},actions:function(b){b.preventDefault();var c=this,d=a.parseJSON(a(b.target).attr("ap-query"));AnsPress.showLoading(b.target),AnsPress.ajax({data:d,success:function(a){AnsPress.hideLoading(b.target),a.success&&(a.model&&c.model.set(a.model),a.commentsCount&&AnsPress.trigger("commentCount",{count:a.commentsCount,postID:c.postID}),"delete_comment"===a.action&&AnsPress.trigger("removeComment",c.model))}})},editCommentForm:function(a){a.preventDefault(),AnsPress.trigger("loadCommentEdit",{postID:this.postID,e:a,comment:this.model})}}),AnsPress.views.Comments=Backbone.View.extend({initialize:function(a){this.model=a.model,this.postID=a.postID,this.collapsed=a.collapsed,this.collapsed_msg=a.collapsed_msg,this.offset=a.offset,this.query=a.query,AnsPress.on("removeComment",this.removeComment,this),this.listenTo(this.model,"remove",this.commentRemoved),this.listenTo(this.model,"add",this.newComment)},events:{"click .ap-comments-more":"loadMore"},renderItem:function(a){this.$el.parent().addClass("have-comments");var b=new AnsPress.views.Comment({model:a,postID:this.postID});return this.$el.append(b.render().$el),b},appendLoadMore:function(){this.$el.find(".ap-comments-more").remove(),this.collapsed&&this.$el.append('<a href="#" class="ap-comments-more">'+this.collapsed_msg+"</a>")},render:function(){var a=this;return this.model.length>0&&(this.model.each(function(b){a.renderItem(b)}),this.appendLoadMore()),this},removeComment:function(a){this.model.remove(a)},commentRemoved:function(b){0===this.model.size()&&this.$el.parent().removeClass("have-comments"),a("#comment-"+b.id).slideUp(400,function(){a(this).remove()})},newComment:function(a){var b=this.renderItem(a);this.appendLoadMore(),b.$el.hide().slideDown(400),this.$el.apScrollTo(null,!0)},loadMore:function(a){a.preventDefault();var b=this;AnsPress.showLoading(a.target),this.query.offset=this.offset,AnsPress.ajax({data:this.query,success:function(c){AnsPress.hideLoading(a.target),b.collapsed=c.collapsed,b.collapsed_msg=c.collapsed_msg,b.offset=c.offset,c.comments.length>0&&b.model.add(c.comments)}})}}),AnsPress.views.Post=Backbone.View.extend({idAttribute:"ID",templateId:"answer",tagName:"div",actions:{view:{},model:{}},id:function(){return"post-"+this.model.get("ID")},initialize:function(a){this.listenTo(this.model,"change:vote",this.voteUpdate),this.listenTo(this.model,"change:hideSelect",this.selectToggle),this.listenTo(AnsPress,"commentCount",this.commentCount),this.listenTo(AnsPress,"loadCommentEdit",this.loadCommentEdit)},events:{"click [ap-vote] > a":"voteClicked",'click [ap="actiontoggle"]:not(.loaded)':"postActions",'click [ap="select_answer"]':"selectAnswer",'click [ap="comment_btn"]':"loadComments",'click [ap="new-comment"]':"loadCommentForm","submit [comment-form]":"submitComment",'click [ap="cancel-comment"]':"hideCommentForm"},voteClicked:function(b){if(b.preventDefault(),!a(b.target).is(".disable")){self=this;var c=a(b.target).is(".vote-up")?"vote_up":"vote_down",d=_.clone(self.model.get("vote")),e=_.clone(d);"vote_up"===c?e.net="vote_up"===e.active?e.net-1:e.net+1:e.net="vote_down"===e.active?e.net+1:e.net-1,self.model.set("vote",e);var f=a.parseJSON(a(b.target).parent().attr("ap-vote"));f.ap_ajax_action="vote",f.type=c,AnsPress.ajax({data:f,success:function(a){a.success&&_.isObject(a.voteData)?self.model.set("vote",a.voteData):self.model.set("vote",d)}})}},voteUpdate:function(a){var b=this;this.$el.find('[ap="votes_net"]').text(this.model.get("vote").net),_.each(["up","down"],function(a){b.$el.find(".vote-"+a).removeClass("voted disable").addClass(b.voteClass("vote_"+a))})},voteClass:function(a){a=a||"vote_up";var b=this.model.get("vote").active,c="";return"vote_up"===b&&"vote_up"===a&&(c="active"),"vote_down"===b&&"vote_down"===a&&(c="active"),a!==b&&""!==b&&(c+=" disable"),c+" prist"},render:function(){var b=this.$el.find("[ap-vote]").attr("ap-vote");return this.model.set("vote",a.parseJSON(b),{silent:!0}),this},postActions:function(b){var c=this,d=a.parseJSON(a(b.target).attr("ap-query"));"undefined"==typeof d.ap_ajax_action&&(d.ap_ajax_action="post_actions"),AnsPress.ajax({data:d,success:function(d){AnsPress.hideLoading(b.target),a(b.target).addClass("loaded"),c.actions.model=new AnsPress.collections.Actions(d.actions),c.actions.view=new AnsPress.views.Actions({model:c.actions.model,postID:c.model.get("ID")}),c.$el.find("postActions .ap-actions").html(c.actions.view.render().$el)}})},selectAnswer:function(b){b.preventDefault();var c=this,d=a.parseJSON(a(b.target).attr("ap-query"));d.ap_ajax_action="toggle_best_answer",AnsPress.ajax({data:d,success:function(d){AnsPress.hideLoading(b.target),d.success&&("selected"===d.action?(c.$el.addClass("best-answer"),a(b.target).addClass("active").text(d.label),AnsPress.trigger("answerToggle",[c.model,!0])):(c.$el.removeClass("best-answer"),a(b.target).removeClass("active").text(d.label),AnsPress.trigger("answerToggle",[c.model,!1])))}})},selectToggle:function(){this.model.get("hideSelect")?this.$el.find('[ap="select_answer"]').addClass("hide"):this.$el.find('[ap="select_answer"]').removeClass("hide")},loadComments:function(b){b.preventDefault();var c=this,d=a(b.currentTarget),e="#comments-"+c.model.id;if(d.is(".loaded"))return void(a(e).is(".have-comments")?a(e).find(".ap-comments").slideUp(400,function(){a(e).removeClass("have-comments")}):c.comments.length>0&&a(e).addClass("have-comments").find(".ap-comments").slideDown(400));var f=a.parseJSON(d.attr("ap-query"));f.ap_ajax_action="load_comments",AnsPress.showLoading(d),AnsPress.ajax({data:f,success:function(a){AnsPress.hideLoading(d),d.addClass("loaded"),c.comments=new AnsPress.collections.Comments(a.comments);var b={model:c.comments,postID:c.model.id,el:e+" .ap-comments",collapsed:a.collapsed,collapsed_msg:a.collapsed_msg,offset:a.offset,query:f},g=new AnsPress.views.Comments(b);g.render(),g.$el.hide().slideDown(400)}})},loadCommentForm:function(b,c){if(b.preventDefault(),_.isEmpty(a(b.target).attr("ap-query")))if(0===this.$el.find(".ap-comment-no-perm").length){var d={msg:a(b.target).attr("ap-msg")},e=_.template(AnsPress.getTemplate("comment-no-permission")());this.$el.find("apComments").append(e(d))}else this.$el.find(".ap-comment-no-perm").remove();else if(0===this.$el.find("[comment-form]").length){var d=a.parseJSON(a(b.target).attr("ap-query")),e=_.template(AnsPress.getTemplate("comment-form")());this.$el.find("apComments").append(e(d)),this.$el.find("[comment-form]").hide().slideDown(400,function(){a(this).find("textarea").focus()})}else this.$el.find("[comment-form]").slideUp(400,function(){a(this).remove()})},loadCommentEdit:function(b){if(this.model.id===b.postID){this.$el.find("[comment-form]").length>0&&this.$el.find("[comment-form]").remove();var c=a.parseJSON(a(b.e.target).attr("ap-query")),d=_.template(AnsPress.getTemplate("comment-form")());this.$el.find("apComments").append(d(c)),this.$el.find("[comment-form]").hide().slideDown(400,function(){a(this).find("textarea").val(b.comment.get("content")).focus()})}},submitComment:function(b){var c=this;return AnsPress.showLoading(b.target),AnsPress.ajax({data:a(b.target).serialize(),success:function(a){AnsPress.hideLoading(b.target),a.success&&(c.comments&&"new-comment"===a.action&&c.comments.add(a.comment),c.comments&&"edit-comment"===a.action&&c.comments.get(a.comment.ID).set(a.comment),a.commentsCount&&AnsPress.trigger("commentCount",{count:a.commentsCount,postID:c.model.id}),c.$el.find("[comment-form]").remove())}}),!1},hideCommentForm:function(b){b.preventDefault(),a(b.target).closest("[comment-form]").remove()},commentCount:function(a){this.model.id===a.postID&&(this.$el.find("[ap-commentscount-text]").text(a.count.text),a.count.unapproved>0?this.$el.find("[ap-un-commentscount]").addClass("have"):this.$el.find("[ap-un-commentscount]").removeClass("have"),this.$el.find("[ap-un-commentscount]").text(a.count.unapproved))}}),AnsPress.collections.Posts=Backbone.Collection.extend({model:AnsPress.models.Post,initialize:function(){var b=[];a('[ap="question"],[ap="answer"]').each(function(c){b.push({ID:a(this).attr("ap-id")})}),this.add(b)}}),AnsPress.views.SingleQuestion=Backbone.View.extend({initialize:function(){this.listenTo(this.model,"add",this.renderItem),AnsPress.on("answerToggle",this.answerToggle,this),AnsPress.on("deletePost",this.deletePost,this),AnsPress.on("answerCountUpdated",this.answerCountUpdated,this)},events:{'click [ap="loadEditor"]':"loadEditor",'submit [ap="answerForm"]':"answerForm"},renderItem:function(a){var b=new AnsPress.views.Post({model:a,el:"#post-"+a.get("ID")});b.render()},render:function(){var a=this;return this.model.each(function(b){a.renderItem(b)}),a},loadEditor:function(b){AnsPress.showLoading(b.target),AnsPress.ajax({data:a(b.target).attr("ap-query"),success:function(c){AnsPress.hideLoading(b.target),a(".ap-field-description").html(c),a(b.target).closest(".ap-minimal-editor").removeClass("ap-minimal-editor")}})},answerForm:function(b){var c=this;return AnsPress.showLoading(a(b.target).find(".ap-btn-submit")),a(b.target).find(".have-error").removeClass("have-error"),a(b.target).find(".error").remove(),AnsPress.ajax({data:a(b.target).serialize(),success:function(d){return d.redirect?void(window.location=d.redirect):("undefined"!=typeof grecaptcha&&"undefined"!=typeof widgetId1&&grecaptcha.reset(widgetId1),AnsPress.trigger("answerFormPosted",d),AnsPress.hideLoading(a(b.target).find(".ap-btn-submit")),AnsPress.uploader&&AnsPress.uploader.splice(),d.success&&(a("ap-answers-w").show(),a("#description").val(""),"undefined"!=typeof tinyMCE&&d.success&&tinyMCE.activeEditor.setContent(""),a("ap-answers").append(a(d.html).hide()),a(d.div_id).slideDown(800),c.model.add({ID:d.ID}),AnsPress.trigger("answerCountUpdated",d.answersCount)),void(d.errors&&_.each(d.errors,function(b,c){a(".ap-field-"+c).addClass("have-error"),"description"===c&&a(".ap-field-ap_upload").length>0&&(c="ap_upload"),a(".ap-field-"+c).append('<span class="error">'+b+"</span>")})))}}),!1},answerToggle:function(a){this.model.forEach(function(b,c){a[0]!==b&&b.set("hideSelect",a[1])})},deletePost:function(b){this.model.remove(b),a("#post-"+b).slideUp(400,function(){a(this).remove()})},answerCountUpdated:function(b){a("[ap-answerscount-text]").text(b.text)}}),AnsPress.views.Modal=Backbone.View.extend({id:"ap-modal",className:"ap-modal",template:AnsPress.getTemplate("modal"),events:{"click [close-modal]":"hide"},initialize:function(a){this.data=a},render:function(){var a=_.template(this.template());return this.$el.html(a(this.data)),this},hide:function(a){a.preventDefault(),this.remove()}});var b=Backbone.Router.extend({routes:{"comment/:commentID":"commentRoute"},commentRoute:function(b,c){AnsPress.ajax({data:ajaxurl+"?action=ap_ajax&ap_ajax_action=get_comment&comment_id="+b,success:function(b){if(b.success){var c=new AnsPress.collections.Comments(b.comment),d=new AnsPress.views.Modal({content:'<apComments class="have-comments"><div class="ap-comments"></div></apComments>',size:"medium"});a("body").append(d.render().$el);var e=new AnsPress.views.Comments({model:c,el:d.$el.find(".ap-comments")});d.$el.find(".ap-modal-content").html(e.render().$el)}}})}});a('[ap="actiontoggle"]').click(function(){a(this).is(".loaded")||AnsPress.showLoading(this)}),a(document).ready(function(){var c=new AnsPress.collections.Posts,d=new AnsPress.views.SingleQuestion({model:c,el:"#anspress"});d.render();new b;Backbone.History.started||Backbone.history.start(),apShowComments&&a('[ap="comment_btn"]').each(function(){a(this).click()})})}(jQuery),function(a){AnsPress.views.AskView=Backbone.View.extend({initialize:function(){},events:{'keyup [data-action="suggest_similar_questions"]':"questionSuggestion"},suggestTimeout:null,questionSuggestion:function(b){var c=this;if(!disable_q_suggestion){var d=a(b.target).val();0!=d.length&&(null!=c.suggestTimeout&&clearTimeout(c.suggestTimeout),c.suggestTimeout=setTimeout(function(){c.suggestTimeout=null,AnsPress.ajax({data:{ap_ajax_action:"suggest_similar_questions",__nonce:ap_nonce,value:d},success:function(b){console.log(b),a("#similar_suggestions").html(b.html)}})},800))}}});new AnsPress.views.AskView({el:"#ap-ask-page"})}(jQuery),function(a){AnsPress.loadTemplate("list"),AnsPress.models.Filter=Backbone.Model.extend({defaults:{active:!1,label:"",value:""}}),AnsPress.collections.Filters=Backbone.Collection.extend({model:AnsPress.models.Filter}),AnsPress.activeListFilters=a("#ap_current_filters").length>0?JSON.parse(a("#ap_current_filters").html()):{},AnsPress.views.Filter=Backbone.View.extend({id:function(){return this.model.id},nameAttr:function(){return this.multiple?""+this.model.get("key")+"[]":this.model.get("key")},isActive:function(){if(this.model.get("active"))return this.model.get("active");if(this.active)return this.active;var a=AnsPress.getUrlParam(this.model.get("key"));if(!_.isEmpty(a)){var b=this.model.get("value");if(!_.isArray(a)&&a===b)return!0;if(_.contains(a,b))return this.active=!0,!0}return this.active=!1,!1},className:function(){return this.isActive()?"active":""},inputType:function(){return this.multiple?"checkbox":"radio"},initialize:function(a){this.model=a.model,this.multiple=a.multiple,this.listenTo(this.model,"remove",this.removed)},template:'<label><input type="{{inputType}}" name="{{name}}" value="{{value}}"<# if(active){ #> checked="checked"<# } #>/><i class="apicon-check"></i>{{label}}</label>',events:{"change input":"clickFilter"},render:function(){var a=_.template(this.template),b=this.model.toJSON();return b.name=this.nameAttr(),b.active=this.isActive(),b.inputType=this.inputType(),this.removeHiddenField(),this.$el.html(a(b)),this},removeHiddenField:function(){a('input[name="'+this.nameAttr()+'"][value="'+this.model.get("value")+'"]').remove()},clickFilter:function(b){b.preventDefault(),a(b.target).closest("form").submit()},removed:function(){this.remove()}}),AnsPress.views.Filters=Backbone.View.extend({className:"ap-dropdown-menu",searchTemplate:'<div class="ap-filter-search"><input type="text" search-filter placeholder="'+aplang.search+'" /></div>',template:'<button class="ap-droptogg apicon-x"></button><filter-items></filter-items>',initialize:function(a){this.model=a.model,this.multiple=a.multiple,this.filter=a.filter,this.nonce=a.nonce,this.listenTo(this.model,"add",this.added)},events:{"keypress [search-filter]":"searchInput"},renderItem:function(a){var b=new AnsPress.views.Filter({model:a,multiple:this.multiple});this.$el.find("filter-items").append(b.render().$el)},render:function(){var a=this;return this.multiple&&this.$el.append(this.searchTemplate),this.$el.append(this.template),this.model.each(function(b){a.renderItem(b)}),this},search:function(a,b){var c=this,d={__nonce:this.nonce,ap_ajax_action:"load_filter_"+this.filter,search:a,filter:this.filter};AnsPress.showLoading(b),AnsPress.ajax({data:d,success:function(a){if(AnsPress.hideLoading(b),a.success){for(c.nonce=a.nonce;model=c.model.first();)model.destroy();c.model.add(a.items)}}})},searchInput:function(b){var c=this;clearTimeout(this.searchTO),this.searchTO=setTimeout(function(){c.search(a(b.target).val(),b.target)},600)},added:function(a){this.renderItem(a)}}),AnsPress.views.List=Backbone.View.extend({el:"#ap-filters",initialize:function(){},events:{"click [ap-filter]:not(.loaded)":"loadFilter","click #ap-filter-reset":"resetFilter"},loadFilter:function(b){b.preventDefault();AnsPress.showLoading(b.currentTarget);
var c=a.parseJSON(a(b.currentTarget).attr("ap-query"));c.ap_ajax_action="load_filter_"+c.filter,AnsPress.ajax({data:c,success:function(d){AnsPress.hideLoading(b.currentTarget),a(b.currentTarget).addClass("loaded");var e=new AnsPress.collections.Filters(d.items),f=new AnsPress.views.Filters({model:e,multiple:d.multiple,filter:c.filter,nonce:d.nonce});a(b.currentTarget).after(f.render().$el)}})},resetFilter:function(b){a('#ap-filters input[type="hidden"]').remove(),a('#ap-filters input[type="checkbox"]').prop("checked",!1)}}),new AnsPress.views.List}(jQuery),function(a){AnsPress.loadTemplate("notifications"),AnsPress.models.Notification=Backbone.Model.extend({idAttribute:"ID",defaults:{ID:"",verb:"",verb_label:"",icon:"",avatar:"",hide_actor:"",actor:"",ref_title:"",ref_type:"",points:"",date:"",permalink:"",seen:""}}),AnsPress.collections.Notifications=Backbone.Collection.extend({model:AnsPress.models.Notification}),AnsPress.views.Notification=Backbone.View.extend({id:function(){return"noti-"+this.model.id},template:AnsPress.getTemplate("notification"),initialize:function(a){this.model=a.model},render:function(){var a=_.template(this.template());return this.$el.html(a(this.model.toJSON())),this}}),AnsPress.views.Notifications=Backbone.View.extend({template:AnsPress.getTemplate("notifications"),initialize:function(a){this.model=a.model,this.mark_args=a.mark_args,this.total=a.total,this.listenTo(this.model,"add",this.newNoti),this.listenTo(AnsPress,"notificationAllRead",this.allRead)},renderItem:function(a){var b=new AnsPress.views.Notification({model:a});return this.$el.find(".scroll-wrap").append(b.render().$el),b},render:function(){var a=this,b=_.template(this.template());return this.$el.html(b({mark_args:this.mark_args,total:this.total})),this.model.length>0&&this.model.each(function(b){a.renderItem(b)}),this},newNoti:function(a){this.renderItem(a)},allRead:function(){this.total=0,this.model.each(function(a){a.set("seen",1)}),this.render()}}),AnsPress.views.NotiDropdown=Backbone.View.extend({id:"noti-dp",initialize:function(a){this.anchor=a.anchor,this.fetched=!1},dpPos:function(){var a=this.anchor.offset();a.top=a.top+this.anchor.height(),a.left=a.left-this.$el.width()+this.anchor.width(),this.$el.css(a)},fetchNoti:function(a,b){if(this.fetched)return void this.dpPos();var c=this;AnsPress.ajax({data:ajaxurl+"?action=ap_ajax&ap_ajax_action=get_notifications",success:function(a){if(c.fetched=!0,a.success){var b=new AnsPress.collections.Notifications(a.notifications),d=new AnsPress.views.Notifications({model:b,mark_args:a.mark_args,total:a.total});c.$el.html(d.render().$el),c.dpPos(),c.$el.show()}}})},render:function(){return this.$el.hide(),this}}),a(document).ready(function(){var b=a('a[href="#apNotifications"]'),c=new AnsPress.views.NotiDropdown({anchor:b});a("body").append(c.render().$el),b.click(function(a){a.preventDefault(),c.fetchNoti(),c.fetched&&c.$el.toggle()}),a(document).mouseup(function(a){b.is(a.target)||c.$el.is(a.target)||0!==c.$el.has(a.target).length||c.$el.hide()})})}(jQuery),function(a){function b(a){var b=["Bytes","KB","MB","GB","TB"];if(0==a)return"0 Byte";var c=parseInt(Math.floor(Math.log(a)/Math.log(1024)));return Math.round(a/Math.pow(1024,c),2)+" "+b[c]}function c(a){return/[.]/.exec(a)?/[^.]+$/.exec(a):void 0}a(document).ready(function(){a('.ap-field-type-upload input[type="file"]').on("change",function(){var d=a(this).data("upload"),e=a(this).closest(".ap-form-group"),f=a(this).parent().find("b");e.removeClass("ap-have-errors"),e.find(".ap-field-errors").remove(),a(this).parent().prev().is(".ap-upload-list")&&a(this).parent().prev().remove(),a('<div class="ap-upload-list"></div>').insertBefore(a(this).parent()),this.files.length>d.max_files&&(AnsPress.trigger("snackbar",{snackbar:{success:!1,message:d.label_max_added}}),e.addClass("ap-have-errors"),a('<div class="ap-field-errors"><span class="ap-field-error">'+d.label_max_added+"</span></div>").insertBefore(e.find(".ap-upload-list"))),f.text(0);for(var g=0;g<this.files.length;g++){var h=this.files[g],i=c(h.name);a(this).attr("accept").indexOf(i)===-1&&(AnsPress.trigger("snackbar",{snackbar:{success:!1,message:d.label_deny_type}}),e.addClass("ap-have-errors")),a('<div><span class="ext">'+i+"</span>"+h.name+'<span class="size">'+b(h.size)+"</span></div>").appendTo(a(this).parent().prev()),f.text(g+1)}})})}(jQuery);
//# sourceMappingURL=main.min.js.map